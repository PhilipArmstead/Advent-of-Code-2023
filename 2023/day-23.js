// Day 23
// Visit the input page https://adventofcode.com/2023/day/23/input
// Paste the following code in to your browser's dev tools and execute it

{
	const start = performance.now()
	// const input = document.body.textContent
	const input = `#.###########################################################################################################################################
#.###.....#.........###...#...#...#####...#...#.......#...###...#.............#.......#.....#...#...#...#...#.............###...#...#...#...#
#.###.###.#.#######.###.#.#.#.#.#.#####.#.#.#.#.#####.#.#.###.#.#.###########.#.#####.#.###.#.#.#.#.#.#.#.#.#.###########.###.#.#.#.#.#.#.#.#
#.#...#...#.#.......#...#...#...#...#...#...#...#.....#.#.###.#.#.........#...#.#.....#...#.#.#.#.#.#.#.#.#.#...........#.#...#.#.#.#.#.#.#.#
#.#.###.###.#.#######.#############.#.###########.#####.#.###.#.#########.#.###.#.#######.#.#.#.#.#.#.#.#.#.###########.#.#.###.#.#.#.#.#.#.#
#.#.#...#...#...#...#...#...........#...........#.###...#.#...#.>.>.#...#.#...#.#...>.>.#.#.#.#.#.#.#.#.#.#.#...#...###.#.#.#...#.#.#.#...#.#
#.#.#.###.#####.#.#.###.#.#####################.#.###.###.#.#####v#.#.#.#.###.#.#####v#.#.#.#.#.#.#.#.#.#.#.#.#.#.#.###.#.#.#.###.#.#.#####.#
#...#...#.#.....#.#.###.#.#...#.......###...###.#.#...###...#.....#.#.#.#...#...###...#...#...#.#.#.#.#...#.#.#.#.#.#...#.#.#...#.#...#...#.#
#######.#.#.#####.#.###.#.#.#.#.#####.###.#.###.#.#.#########.#####.#.#.###.#######.###########.#.#.#.#####.#.#.#.#.#.###.#.###.#.#####.#.#.#
#.......#.#.###...#...#.#.#.#.#.....#.#...#...#.#.#.......###.#...#.#.#...#.#.....#.........#...#.#.#.#.....#.#.#.#.#.#...#...#...###...#.#.#
#.#######.#.###.#####.#.#.#.#.#####.#.#.#####.#.#.#######.###.#.#.#.#.###.#.#.###.#########.#.###.#.#.#.#####.#.#.#.#.#.#####.#######.###.#.#
#.#.....#.#.....#.....#.#.#.#.#.....#.#.....#.#.#.#.....#...#...#.#.#...#...#...#.#.......#.#.#...#...#.....#.#...#.#.#.......#...#...###...#
#.#.###.#.#######.#####.#.#.#.#.#####.#####.#.#.#.#.###.###.#####.#.###.#######.#.#.#####.#.#.#.###########.#.#####.#.#########.#.#.#########
#...###...#.......#...#.#.#.#.#.#.....###...#.#.#...###.....#...#.#.....#...#...#.#.....#.#.#.#...#.........#.....#...#.......#.#...###.....#
###########v#######.#.#.#.#.#.#.#.#######.###.#.#############.#.#.#######.#.#.###.#####.#.#.#.###.#.#############.#####.#####.#.#######.###.#
###...#...#.>.#.....#.#.#.#.#.#.#.>.>.#...#...#...#...........#...###.....#.#...#.#...#.#.#.#.#...#.....#.>.>.....#...#.....#.#.........#...#
###.#.#.#.#v#.#.#####.#.#.#.#.#.###v#.#.###.#####.#.#################.#####.###.#.#.#.#.#.#.#.#.#######.#.#v#######.#.#####.#.###########.###
#...#...#...#.#...#...#.#.#.#.#.#...#...###...#...#...#...#.........#.#...#.....#...#...#...#...###...#.#.#.........#...#...#.............###
#.###########.###.#.###.#.#.#.#.#.###########.#.#####.#.#.#.#######.#.#.#.#########################.#.#.#.#############.#.###################
#...#.......#.#...#.....#.#.#...#.#...#...###...#...#...#...#.......#...#.............#...#.........#.#...#...#.....#...#...#.....#.........#
###.#.#####.#.#.#########.#.#####.#.#.#.#.#######.#.#########.#######################.#.#.#.#########.#####.#.#.###.#.#####.#.###.#.#######.#
#...#.#.....#...###...###...###...#.#...#.........#...#.......#...###.................#.#.#.........#.......#.#...#...#####...###...#...#...#
#.###.#.###########.#.#########.###.#################.#.#######.#.###.#################.#.#########.#########.###.###################.#.#.###
#.#...#.#...#...#...#.........#.....###...........#...#.........#...#.....#...#...###...#.#...#...#.........#.#...#.....#...#...#...#.#...###
#.#.###.#.#.#.#.#.###########.#########.#########.#.###############.#####.#.#.#.#.###.###.#.#.#.#.#########.#.#.###.###.#.#.#.#.#.#.#.#######
#...###.#.#.#.#...#...........#.........#.....###...###.............#...#...#...#...#.#...#.#.#.#.###...#...#.#...#...#.#.#.#.#.#.#.#.#...###
#######.#.#.#.#####.###########.#########.###.#########.#############.#.###########.#.#.###.#.#.#.###.#.#.###.###.###.#.#.#.#.#.#.#.#.#.#.###
#.......#.#.#.....#...#.....###...........#...#...#...#.........#...#.#...###.......#.#.###.#.#.#.#...#...###.....###.#...#...#...#...#.#...#
#.#######.#.#####.###.#.###.###############.###.#.#.#.#########.#.#.#.###.###.#######.#.###.#.#.#.#v#################.#################.###.#
#.......#.#.#.....#...#.#...#...#...#...#...#...#.#.#...#.......#.#.#...#.....###...#.#.#...#...#.>.>.#...###...###...#...#.............#...#
#######.#.#.#.#####v###.#.###.#.#.#.#.#.#v###.###.#.###.#.#######.#.###.#########.#.#.#.#.#########v#.#.#.###.#.###.###.#.#.#############.###
#.....#...#...#...#.>.#.#.#...#.#.#.#.#.>.>.#...#.#.#...#.....###.#...#.......###.#.#.#.#...#.......#...#.....#...#.....#.#.#.............###
#.###.#########.#.#v#.#.#.#.###.#.#.#.###v#.###.#.#.#.#######v###.###.#######.###.#.#.#.###.#.###################.#######.#.#.###############
#...#.#...#...#.#.#.#.#.#.#...#.#.#...#...#...#.#.#.#...#...>.>.#.#...#...###.#...#.#.#.#...#.#.....###...........#.....#...#...........#####
###.#.#.#.#.#.#.#.#.#.#.#.###.#.#.#####.#####.#.#.#.###.#.###v#.#.#.###.#.###v#.###.#.#.#.###.#.###.###.###########.###.###############.#####
#...#.#.#.#.#...#...#...#.#...#.#.###...#####...#.#...#.#.###.#.#.#...#.#.#.>.>.###.#.#.#...#...###...#...###...###...#.#.............#.....#
#.###.#.#.#.#############.#.###.#.###.###########.###.#.#.###.#.#.###.#.#.#.#v#####.#.#.###.#########.###.###.#.#####.#.#.###########.#####.#
#...#.#.#.#...#.........#.#.#...#...#.......#.....#...#...#...#...###...#...#.....#.#.#.#...###.......###...#.#...#...#.#.........###.......#
###.#.#.#.###.#.#######.#.#.#.#####.#######.#.#####.#######.#####################.#.#.#.#.#####.###########.#.###.#.###.#########.###########
#...#...#.###...#...#...#...#.....#.#.......#...#...#.....#.........#.............#...#.#.#.....#...#...###...#...#...#.#...#...#.....#######
#.#######.#######.#.#.###########.#.#.#########.#.###.###.#########.#.#################.#.#.#####.#.#.#.#######.#####.#.#.#.#.#.#####.#######
#...#...#.#...#...#.#...#...#...#...#.........#.#.###...#.......#...#.........#.......#...#.......#...#.....###.#.....#.#.#.#.#.#...#.......#
###.#.#.#.#.#.#.###.###.#.#.#.#.#############.#.#.#####.#######.#.###########.#.#####.#####################.###.#.#####.#.#.#.#.#v#.#######.#
#...#.#.#...#...###.....#.#...#.............#.#.#.#.....#.....#...#...#.......#.#.....###...............#...#...#.....#.#.#...#.>.#.#.......#
#.###.#.#################.#################.#.#.#.#.#####.###.#####.#.#.#######.#.#######.#############.#.###.#######.#.#.#######v#.#.#######
#.....#.................#...#.....#.......#.#.#.#.#.#.....###.......#.#.........#.......#.............#.#.###...#...#.#.#.#.......#...###...#
#######################.###.#.###.#.#####.#.#.#.#.#.#.###############.#################.#############.#.#.#####.#.#.#.#.#.#.#############.#.#
#.......................###...#...#.#.....#.#.#.#.#.#.#...............#...........#.....#.............#...#.....#.#.#.#.#.#...#...#.......#.#
#.#############################.###.#.#####.#.#.#.#.#.#.###############.#########.#.#####.#################.#####.#.#.#.#.###.#.#.#.#######.#
#...........................#...#...#.....#...#.#.#...#...............#.........#.#.....#.#...............#.....#.#.#.#.#.###...#...#.......#
###########################.#.###.#######.#####.#.###################.#########.#.#####.#.#.#############.#####.#.#.#.#.#.###########.#######
#...#.....#.....#...#.....#.#.....#...#...#...#...###...#...#.........###...#...#...#...#...#.............#.....#.#...#...#.........#.......#
#.#.#.###.#.###.#.#.#.###.#.#######.#.#.###.#.#######.#.#.#.#.###########.#.#.#####.#.#######.#############.#####.#########.#######.#######.#
#.#.#...#.#...#...#.#...#.#.#.......#...#...#.#.....#.#...#.#.....#...#...#...#...#...###...#.............#.......#.....#...#.....#...#.....#
#.#.###.#.###.#####.###.#.#.#.###########.###.#.###.#.#####.#####.#.#.#.#######.#.#######.#.#############.#########.###.#.###.###.###.#.#####
#.#.....#...#.....#.....#...#.............#...#...#.#...#...###...#.#.#.........#...#.....#...#...........#...#...#...#.#.....###...#...#...#
#.#########.#####.#########################.#####.#.###.#.#####.###.#.#############.#.#######.#.###########.#.#.#.###.#.###########.#####.#.#
#.........#.#.....#...#...#...#.............#...#.#.#...#.#...#.....#.#...###.......#...#.....#.......#...#.#.#.#.#...#.#...###...#.....#.#.#
#########.#.#.#####.#.#.#.#.#.#.#############.#.#.#.#.###.#.#.#######.#.#.###.#########.#.###########.#.#.#.#.#.#.#.###.#.#.###.#.#####.#.#.#
#.....#...#.#.....#.#.#.#.#.#.#.........#...#.#.#.#.#...#.#.#.#.......#.#.#...#...#...#.#.#...#...#...#.#.#.#.#.#.#...#.#.#.###.#.#.....#.#.#
#.###.#.###.#####.#.#.#.#.#.#.#########.#.#.#.#.#.#.###.#.#.#.#v#######.#.#.###.#.#.#.#.#.#.#.#.#.#v###.#.#.#.#.#.###.#.#.#.###.#.#v#####.#.#
#...#...###.......#.#.#.#.#.#.#...#.....#.#...#.#.#.#...#.#.#.>.>.....#.#.#...#.#...#.#.#.#.#...#.>.>...#.#.#.#.#.#...#.#.#...#.#.>.#.....#.#
###.###############.#.#.#.#.#.#.#.#.#####.#####.#.#.#.###.#.###v#####.#.#.###.#.#####.#.#.#.#######v#####.#.#.#.#.#.###.#.###.#.###v#.#####.#
#...#...###.....#...#...#.#.#.#.#...#...#.....#.#.#.#.#...#...#...###...#...#.#...#...#.#.#...#...#.....#.#.#...#.#.###.#.#...#.#...#.#.....#
#.###.#v###.###.#.#######.#.#.#.#####.#.#####.#.#.#.#.#.#####.###.#########.#v###.#.###.#.###.#.#.#####.#.#.#####.#.###.#.#.###.#.###.#.#####
#.....#.>.#.#...#.....#...#.#.#.......#.###...#.#.#.#.#...#...###...#...###.>.>...#.....#.#...#.#.......#.#.#.....#.#...#.#.....#...#.#.#...#
#######v#.#.#.#######.#.###.#.#########v###.###.#.#.#.###.#.#######.#.#.#####v###########.#.###.#########.#.#.#####.#.###.#########.#.#.#.#.#
#.......#...#.#...#...#...#.#...#...#.>.>.#...#...#...#...#...#...#...#.#...#.........###...###.....#...#...#.....#.#...#.###...###...#...#.#
#.###########.#.#.#.#####.#.###.#.#.#.#v#.###.#########.#####.#.#.#####.#.#.#########.#############.#.#.#########.#.###.#.###.#.###########.#
#.....#...###...#...###...#...#.#.#...#.#...#.........#.......#.#.#.....#.#...........#.......#.....#.#.........#.#.#...#.#...#.#...###...#.#
#####.#.#.#############.#####.#.#.#####.###.#########.#########.#.#.#####.#############.#####.#.#####.#########.#.#.#.###.#.###.#.#.###.#.#.#
#.....#.#.............#.......#...#...#...#.#.....#...#...#...#.#.#.....#.....#.....#...#.....#.......#.......#.#...#.....#...#...#.....#...#
#.#####.#############.#############.#.###.#.#.###.#.###.#.#.#.#.#.#####.#####.#.###.#.###.#############.#####.#.#############.###############
#.....#.#...........#.#.....###.....#.....#.#...#...#...#...#...#.....#.###...#...#.#...#.#.....###.....#...#...#.....#.......#.............#
#####.#.#.#########.#.#.###.###.###########.###.#####.###############.#.###v#####.#.###.#.#.###.###.#####.#.#####.###.#.#######.###########.#
#.....#.#...###...#...#...#...#...........#...#.#...#...#...#...#...#...#.>.>.....#.#...#.#...#...#.......#.#...#.#...#.....#...#...###...#.#
#.#####.###.###.#.#######.###.###########.###.#.#.#.###.#.#.#.#.#.#.#####.#v#######.#.###.###.###.#########.#.#.#.#.#######.#.###.#.###.#.#.#
#.......###...#.#...###...#...#...........###...#.#...#...#...#...#.#.....#.#.......#...#...#.#...###.......#.#.#.#.#...###...#...#.....#.#.#
#############.#.###v###.###.###.#################.###.#############.#.#####.#.#########.###.#.#.#####.#######.#.#.#.#.#.#######.#########.#.#
###...#######...###.>...#...###...#.......#...###.#...#.......#...#.#.....#.#...#.......#...#.#.#...#...#...#.#.#.#.#.#.#...###.........#.#.#
###.#.#############v#####.#######.#.#####.#.#.###.#.###.#####.#.#.#.#####.#.###.#.#######.###.#.#.#.###v#.#.#.#.#.#.#.#.#.#.###########.#.#.#
#...#...#.........#.....#...#...#...#...#.#.#...#.#...#.....#...#...#.....#...#.#.....#...#...#.#.#...>.>.#.#.#.#.#.#.#.#.#.###.........#...#
#.#####.#.#######.#####.###.#.#.#####.#.#.#.###.#.###.#####.#########.#######.#.#####.#.###.###.#.#####v###.#.#.#.#.#.#.#.#.###.#############
#.....#.#.......#.......###...#.#.....#.#.#.#...#.#...#...#.#.......#.....#...#...#...#...#...#...###...###...#...#.#.#.#.#...#.............#
#####.#.#######.###############.#.#####.#.#.#.###.#.###.#.#.#.#####.#####.#.#####.#.#####.###.#######.#############.#.#.#.###.#############.#
#.....#...#...#.#.......#...#...#.....#...#.#.#...#...#.#.#...#...#...#...#.#...#.#.#...#.#...###.....###...###.....#.#.#.#...#...#...#...#.#
#.#######.#.#.#.#.#####.#.#.#.#######.#####.#.#.#####.#.#.#####.#.###.#.###.#.#.#.#.#.#.#.#.#####.#######.#.###.#####.#.#.#.###.#.#.#.#v#.#.#
#.#.....#...#...#.#.....#.#...#...###.#...#.#.#...#...#.#.#...#.#.#...#...#...#.#...#.#.#...#...#.......#.#.....#...#.#.#.#...#.#...#.>.#.#.#
#.#.###.#########.#.#####.#####.#.###v#.#.#.#.###.#.###.#.#.#.#.#.#v#####.#####.#####.#.#####.#.#######.#.#######.#.#.#.#.###.#.#######v#.#.#
#.#.#...#...#.....#...#...#...#.#...>.>.#.#.#.#...#.#...#.#.#.#.#.>.>.....#.....#.....#.#.....#.........#.......#.#.#.#.#...#.#.###...#.#...#
#.#.#.###.#.#.#######.#.###.#.#.#####v###.#.#.#.###.#.###.#.#.#.###v#######.#####.#####.#.#####################.#.#.#.#.###.#.#.###.#.#.#####
#...#.....#...#.......#.....#.#.#.....###.#.#.#...#.#.#...#.#.#...#.......#.....#...#...#.#...#...#...#.....###...#.#.#...#.#...#...#.#.....#
###############.#############.#.#.#######.#.#.###.#.#.#.###.#.###.#######.#####.###.#.###.#.#.#.#.#.#.#.###.#######.#.###.#.#####.###.#####.#
#.............#.....#...#...#...#.......#.#.#.#...#...#...#.#.#...#.....#.#...#.....#...#...#.#.#.#.#...#...#.....#...###.#.#...#...#.#...#.#
#.###########.#####.#.#.#.#.###########.#.#.#.#.#########.#.#.#.###.###.#.#.#.#########.#####.#.#.#.#####.###.###.#######.#.#.#.###.#.#.#.#.#
#.#.........#.......#.#.#.#.#...#...#...#.#.#.#...#.......#.#...#...###.#.#.#...........#...#...#...#...#...#...#.###...#...#.#.#...#.#.#...#
#.#.#######.#########.#.#.#.#.#.#.#.#.###.#.#.###.#.#######.#####.#####.#.#.#############.#.#########.#.###.###.#.###.#.#####.#.#.###.#.#####
#...#...#...#...#...#.#.#.#.#.#...#...###...#.....#...#...#.#...#.....#.#.#.#.............#.#.....#...#.....#...#...#.#...#...#.#...#...#...#
#####.#.#.###.#.#.#v#.#.#.#.#v#######################.#.#.#.#.#.#####.#.#.#.#.#############.#.###.#.#########.#####.#.###.#.###.###.#####.#.#
#.....#...#...#...#.>.#...#.>.>.......#...#.........#.#.#...#.#.......#.#.#...#...#.........#...#.#...#.....#.....#.#.#...#...#...#.......#.#
#.#########.#######v#########v#######.#.#.#.#######.#.#.#####.#########.#.#####.#.#.###########.#.###.#.###.#####.#.#.#.#####v###.#########.#
#...........###.....#...#.....#.......#.#.#.......#.#...###...#.....###.#.#.....#...#...#.......#.....#...#.#...#.#.#.#...#.>.###.#.......#.#
###############.#####.#.#.#####.#######.#.#######.#.#######.###.###.###.#.#.#########.#.#.###############.#.#.#.#.#.#.###.#.#v###.#.#####.#.#
#.....#...#.....#.....#.#.....#...#...#.#.#.......#...#...#.....###...#...#.........#.#.#.#.....#.....###.#.#.#.#.#.#.###...#...#.#.....#...#
#.###.#.#.#.#####.#####.#####.###.#.#.#.#.#.#########.#.#.###########.#############.#.#.#.#.###.#.###.###.#.#.#.#.#.#.#########.#.#####.#####
#...#.#.#.#.......#...#.#.....#...#.#.#.#.#.....#.....#.#...#...#.....#...#.........#.#.#...###...#...#...#.#.#.#.#.#.#.........#.#...#.....#
###.#.#.#.#########.#.#.#.#####.###.#.#.#.#####.#.#####.###.#.#.#.#####.#.#v#########.#.###########.###.###.#.#.#.#.#.#.#########.#.#.#####.#
#...#...#.#.....#...#...#.....#...#.#.#.#.#...#.#.#...#.#...#.#.#...#...#.>.>.#...###.#.#...#...###...#...#.#.#.#.#.#.#.....#...#...#.......#
#.#######.#.###.#.###########.###.#.#.#.#.#.#.#.#.#.#.#.#.###.#.###v#.#####v#.#.#.###.#.#.#.#.#.#####v###.#.#.#.#.#.#.#####.#.#.#############
#.......#.#...#.#.......#.....###...#...#.#.#.#.#.#.#.#.#...#.#.#.>.>.###...#...#...#.#...#.#.#.#...>.>...#...#...#...###...#.#...###...#####
#######.#.###.#.#######.#.###############.#.#.#.#.#.#.#.###.#.#.#.#v#####.#########.#.#####.#.#.#.###v###################.###.###.###.#.#####
#.......#.....#.........#.....#...#...###...#.#.#...#...#...#.#...#.....#.......#...#.....#.#.#...###.....#...###...#...#...#.###.....#.....#
#.###########################.#.#.#.#.#######.#.#########.###.#########.#######.#.#######.#.#.###########.#.#.###.#.#.#.###.#.#############.#
#...................#...###...#.#.#.#.#.....#.#.#.........#...#.........#.......#.....#...#.#.#...........#.#.#...#...#.###...#.............#
###################.#.#.###.###.#.#.#.#.###.#.#.#.#########.###.#########.###########.#.###.#.#.###########.#.#.#######.#######.#############
#.........#.........#.#...#...#.#.#.#.#.#...#...#.......#...###.........#.........###...#...#.#...#...#.....#.#.#...#...#.....#.........#...#
#.#######.#.#########.###.###.#.#.#.#.#.#.#############.#.#############.#########.#######.###.###.#.#.#.#####.#.#.#.#.###.###.#########.#.#.#
#.......#...#####...#.#...#...#.#...#.#.#.#...#...#.....#...#...#...#...#.........#.....#.....###...#...#.....#.#.#.#...#...#...........#.#.#
#######.#########.#.#.#.###.###.#####.#.#.#.#.#.#.#.#######.#.#.#.#.#.###.#########.###.#################.#####.#.#.###.###.#############.#.#
#...###.........#.#...#...#.....#...#...#...#...#.#...#...#.#.#...#...###.........#.#...#...###...#...#...#...#.#.#.....###...........###.#.#
#.#.###########.#.#######.#######.#.#############.###.#.#.#.#.###################.#.#.###.#.###.#.#.#.#.###.#.#.#.###################.###.#.#
#.#.............#.......#.....###.#.#.............#...#.#.#.#.............###...#...#...#.#.....#...#.#...#.#...#...#.....#...###.....#...#.#
#.#####################.#####.###.#.#.#############.###.#.#.#############.###.#.#######.#.###########.###.#.#######.#.###.#.#.###v#####.###.#
#...#.......#######...#.#.....#...#.#.............#...#.#...#...........#.#...#...#.....#...........#.#...#.#.......#.#...#.#.#.>.#...#.#...#
###.#.#####.#######.#.#.#.#####.###.#############.###.#.#####.#########.#.#.#####.#.###############.#.#.###.#.#######.#.###.#.#.#v#.#.#.#.###
###...#...#.....#...#.#.#.#...#.#...#...#.........###...#...#.........#...#.....#...###...#...#...#.#.#.....#.....###.#.#...#.#.#.#.#...#...#
#######.#.#####.#.###.#.#.#.#.#.#.###.#.#v###############.#.#########.#########.#######.#.#.#.#.#.#.#.###########v###.#.#.###.#.#.#.#######.#
#...#...#.......#...#.#.#...#.#.#...#.#.>.>.###...#...#...#.###.......###.......#...###.#...#.#.#.#.#.#...#...#.>.>...#.#...#.#.#.#.#.......#
#.#.#.#############.#.#.#####.#.###.#.#####.###.#.#.#.#.###.###.#########.#######.#.###.#####.#.#.#.#.#.#.#.#.#.#######.###.#.#.#.#.#.#######
#.#.#.........#...#.#.#.....#.#.###...#####...#.#.#.#.#...#...#.....#...#.....###.#...#.....#.#.#...#...#.#.#.#.#.......#...#.#.#.#.#.#.....#
#.#.#########.#.#.#.#.#####.#.#.#############.#.#.#.#.###.###.#####.#.#.#####.###.###.#####.#.#.#########.#.#.#.#.#######.###.#.#.#.#.#.###.#
#.#...........#.#...#.......#.#...#...###.....#.#.#.#.###.#...#.....#.#...#...#...#...#...#.#.#.........#.#.#.#.#...#...#.###...#...#...###.#
#.#############.#############.###.#.#.###.#####.#.#.#.###.#.###.#####.###.#.###.###.###.#.#.#.#########.#.#.#.#.###.#.#.#.#################.#
#.#...#...#...#...........###.....#.#.....#...#.#...#.#...#...#.....#.#...#...#...#...#.#.#.#...#...#...#.#.#.#.###.#.#.#.......###.........#
#.#.#.#.#.#.#.###########.#########.#######.#.#.#####.#.#####.#####.#.#.#####v###.###.#.#.#.###.#.#.#.###.#.#.#.###.#.#.#######.###.#########
#.#.#...#.#.#...#.......#.....#.....#.....#.#.#.#.....#...#...###...#.#...#.>.>...#...#.#.#...#.#.#...###...#.#...#...#.#.......#...#.......#
#.#.#####.#.###.#.#####.#####.#.#####.###.#.#.#.#.#######.#.#####v###.###.#.#######.###.#.###.#.#.###########.###.#####.#.#######.###.#####.#
#.#.#.....#...#.#.....#.#...#.#.#...#...#.#.#.#.#.#...#...#.#...>.>.#.###.#.....#...#...#.#...#.#...#.........#...#.....#.......#.#...#.....#
#.#.#.#######.#.#####.#.#.#.#.#.#.#.###.#.#.#.#.#.#.#.#.###.#.#####.#.###.#####.#.###.###.#.###.###.#.#########.###.###########.#.#.###.#####
#...#.........#.......#...#...#...#.....#...#...#...#...###...#####...###.......#.....###...###.....#...........###.............#...###.....#
###########################################################################################################################################.#
`
		.trim().split('\n')
	const startY = 0
	const startX = input[0].indexOf('.')
	const endY = input.length - 1
	const endX = input[endY].indexOf('.')

	const Direction = { UP: 1, RIGHT: 2, DOWN: 4, LEFT: 8 }
	const directions = {
		[Direction.UP]: [0, -1],
		[Direction.RIGHT]: [1, 0],
		[Direction.DOWN]: [0, 1],
		[Direction.LEFT]: [-1, 0],
	}
	const tiles = {
		'#': 0,
		'.' : Direction.UP | Direction.RIGHT | Direction.DOWN | Direction.LEFT,
		'>' : Direction.UP | Direction.RIGHT | Direction.DOWN | Direction.LEFT,
		'v' : Direction.UP | Direction.RIGHT | Direction.DOWN | Direction.LEFT,
		'<' : Direction.UP | Direction.RIGHT | Direction.DOWN | Direction.LEFT,
	}
	const slipperyTiles = {
		...tiles,
		'.' : Direction.UP | Direction.RIGHT | Direction.DOWN | Direction.LEFT,
		'>' : Direction.UP | Direction.RIGHT | Direction.DOWN,
		'v' : Direction.RIGHT | Direction.DOWN | Direction.LEFT,
		'<' : Direction.UP | Direction.DOWN | Direction.LEFT,
	}

	const solveMaze = (isSlippery = true) => {
		const positions = [[startX, startY, 0, new Set([`${startX},${startY}`])]]
		const finishes = []
		const tileSet = isSlippery ? slipperyTiles : tiles

		while (positions.length) {
			const [x, y, steps, localVisits] = positions.pop()

			if (x === endX && y === endY) {
				finishes.push(steps)
				continue
			}

			for (const d in Direction) {
				const direction = directions[Direction[d]]
				const tX = x + direction[0]
				const tY = y + direction[1]

				if (
					tY >= 0 &&
					tY < input.length &&
					tX >= 0 &&
					tX < input[0].length &&
					tileSet[input[tY][tX]] & Direction[d] &&
					!localVisits.has(`${tX},${tY}`)
				) {
					localVisits.add(`${tX},${tY}`)
					positions.push([tX, tY, steps + 1, new Set(localVisits)])
				}
			}
		}

		return finishes.reduce((max, cur) => Math.max(max, cur), 0)
	}

	// Part one
	// console.log('Solution to part one:', solveMaze())

	// Part two
	console.log('Solution to part two:', solveMaze(false), performance.now() - start)
}
